<div class="admin-products">
  <div class="header">
    <h1>إدارة المنتجات</h1>
    <button class="add-button" (click)="openModal()">إضافة منتج جديد</button>
  </div>

  <div class="filters">
    <div class="search-box">
      <input type="text" [(ngModel)]="searchTerm" (input)="filterProducts()" placeholder="بحث عن منتج...">
    </div>
    <div class="category-filter">
      <select [(ngModel)]="selectedCategory" (change)="filterProducts()">
        <option [ngValue]="null">جميع التصنيفات</option>
        <option *ngFor="let category of categories" [value]="category.id">
          {{ category.name }}
        </option>
      </select>
    </div>
  </div>

  <div class="products-grid">
    <div class="product-card" *ngFor="let product of filteredProducts">
      <div class="product-image">
        <img [src]="product.images?.[0]?.imageUrl" [alt]="product.title">
      </div>
      <div class="product-info">
        <h3>{{ product.title }}</h3>
        <div class="price-container">
          <p class="price">{{ product.price }}</p>
          <p class="currency">دينار</p>
        </div>
        <p class="stock">المخزون: {{ product.stock }}</p>
        <span class="category-badge">{{ product.category?.name || 'بدون تصنيف' }}</span>
      </div>
      <div class="product-actions">
        <button class="edit" (click)="editProduct(product)">تعديل</button>
        <button class="delete" (click)="deleteProduct(product.id)">حذف</button>
      </div>
    </div>
  </div>

  <div class="form-modal" *ngIf="isModalOpen">
    <div class="modal-content">
      <div class="modal-header">
        <h2>{{ selectedProduct ? 'تعديل منتج' : 'إضافة منتج جديد' }}</h2>
        <button class="close-button" (click)="closeModal()">×</button>
      </div>
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="title">اسم المنتج</label>
          <input type="text" id="title" formControlName="title">
          <div class="error-message" *ngIf="productForm.get('title')?.invalid && productForm.get('title')?.touched">
            اسم المنتج مطلوب ويجب أن يكون 3 أحرف على الأقل
          </div>
        </div>

        <div class="form-group">
          <label for="description">الوصف</label>
          <textarea id="description" formControlName="description" rows="4"></textarea>
          <div class="error-message" *ngIf="productForm.get('description')?.invalid && productForm.get('description')?.touched">
            الوصف مطلوب ويجب أن يكون 10 أحرف على الأقل
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="price">السعر</label>
            <input type="number" id="price" formControlName="price" min="0" step="0.01">
            <div class="error-message" *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched">
              السعر مطلوب ويجب أن يكون أكبر من 0
            </div>
          </div>

          <div class="form-group">
            <label for="stock">المخزون</label>
            <input type="number" id="stock" formControlName="stock" min="0">
            <div class="error-message" *ngIf="productForm.get('stock')?.invalid && productForm.get('stock')?.touched">
              المخزون مطلوب ويجب أن يكون أكبر من 0
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="categoryId">التصنيف</label>
          <select id="categoryId" formControlName="categoryId">
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
          <div class="error-message" *ngIf="productForm.get('categoryId')?.invalid && productForm.get('categoryId')?.touched">
            التصنيف مطلوب
          </div>
        </div>

        <div class="form-group">
          <label for="images">الصور</label>
          <input type="file" multiple  id="images" accept="image/*" (change)="onImageChange($event)">
          <div class="image-preview" *ngIf="imagePreview">
            <img [src]="imagePreview" alt="Preview">
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="cancel" (click)="closeModal()">إلغاء</button>
          <button type="submit" [disabled]="!productForm.valid">حفظ</button>
        </div>
      </form>
    </div>
  </div>
</div>